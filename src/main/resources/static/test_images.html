<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>My Page Images Test (Cookie Auth)</title>
    <style>
        /* (ìŠ¤íƒ€ì¼ì€ ì´ì „ê³¼ ë™ì¼) */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 25px;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }
        .controls label {
            font-weight: 600;
        }
        .controls input[type="number"] {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        .controls button {
            padding: 10px 18px;
            font-size: 15px;
            font-weight: 600;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .controls button:hover {
            background-color: #2980b9;
        }
        .controls button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }
        #pageInfo {
            font-weight: 600;
            font-size: 16px;
        }
        #resultsGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .image-card {
            background: #fdfdfd;
            border: 1px solid #eaeaea;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .image-card h3 {
            font-size: 16px;
            color: #34495e;
            word-wrap: break-word;
            margin-top: 0;
        }
        .image-card p {
            font-size: 13px;
            color: #7f8c8d;
        }
        .image-pair {
            display: flex;
            gap: 10px;
        }
        .image-pair img {
            width: 50%;
            height: auto;
            border-radius: 4px;
            border: 1px solid #eee;
        }
        pre {
            background-color: #2d3436;
            color: #dfe6e9;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“¸ ë‚´ ë¶„ì„ ì´ë¯¸ì§€ ëª©ë¡ í…ŒìŠ¤íŠ¸ (ì¿ í‚¤ ì¸ì¦ ë°©ì‹)</h1>

    <div class="controls">
        <p><strong>(ì£¼ì˜)</strong> ì´ í˜ì´ì§€ë¥¼ ì—´ê¸° ì „ì— ë¨¼ì € <a href="/" target="_blank">ë¡œê·¸ì¸</a>ì„ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.</p>
        <label for="pageSize">Size:</label>
        <input type="number" id="pageSize" value="10" min="1">
        <button id="fetchButton">1í˜ì´ì§€ ì¡°íšŒ</button>
    </div>

    <div class="pagination">
        <button id="prevButton" disabled>ì´ì „ í˜ì´ì§€</button>
        <span id="pageInfo"></span>
        <button id="nextButton" disabled>ë‹¤ìŒ í˜ì´ì§€</button>
    </div>

    <hr>

    <h2>ê²°ê³¼</h2>
    <div id="resultsGrid">
        <p>ë¨¼ì € ë¡œê·¸ì¸ì„ í•˜ì‹  í›„, '1í˜ì´ì§€ ì¡°íšŒ' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
    </div>

    <h2>Raw JSON Response</h2>
    <pre id="jsonResponse"></pre>
</div>

<script>
    const API_URL = '/api/mypage/images';
    let currentPage = 1;
    let totalPages = 1;

    const sizeInput = document.getElementById('pageSize');
    const fetchBtn = document.getElementById('fetchButton');
    const prevBtn = document.getElementById('prevButton');
    const nextBtn = document.getElementById('nextButton');
    const pageInfo = document.getElementById('pageInfo');
    const resultsGrid = document.getElementById('resultsGrid');
    const jsonResponse = document.getElementById('jsonResponse');

    async function fetchImages(page) {
        const size = sizeInput.value;
        const url = new URL(API_URL, window.location.origin);
        url.searchParams.append('page', page);
        url.searchParams.append('size', size);

        try {
            // â¬‡ï¸â¬‡ï¸â¬‡ï¸ ì´ ë¶€ë¶„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤ â¬‡ï¸â¬‡ï¸â¬‡ï¸
            // headers ê°ì²´ë¥¼ ì•„ì˜ˆ ì œê±°í•©ë‹ˆë‹¤.
            // ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ 'accessToken' ì¿ í‚¤ë¥¼ ì „ì†¡í•  ê²ƒì…ë‹ˆë‹¤.
            const response = await fetch(url, {
                method: 'GET'
            });
            // â¬†ï¸â¬†ï¸â¬†ï¸ ì´ ë¶€ë¶„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤ â¬†ï¸â¬†ï¸â¬†ï¸

            const data = await response.json();

            jsonResponse.textContent = JSON.stringify(data, null, 2);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            displayImages(data.content);
            updatePagination(data);

        } catch (error) {
            console.error('Error fetching images:', error);

            if (error instanceof SyntaxError) {
                // response.json() ì‹¤íŒ¨ ì‹œ (ì¦‰, HTMLì´ ë°˜í™˜ë  ë•Œ)
                resultsGrid.innerHTML = `<p style="color: red;">ì˜¤ë¥˜: JSONì´ ì•„ë‹Œ HTMLì´ ë°˜í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. <strong>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</strong></p>`;
                jsonResponse.textContent = `Error: Not valid JSON. Are you logged in?`;
            } else {
                resultsGrid.innerHTML = `<p style="color: red;">ì˜¤ë¥˜ ë°œìƒ: ${error.message}</p>`;
                jsonResponse.textContent = `Error: ${error.message}`;
            }
        }
    }

    function displayImages(images) {
        resultsGrid.innerHTML = '';
        if (!images || images.length === 0) {
            resultsGrid.innerHTML = '<p>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        images.forEach(image => {
            const card = document.createElement('div');
            card.className = 'image-card';
            const analysis = image.analysisResult ? image.analysisResult.replace(/[\[\]']/g, '') : 'N/A';
            const createdAt = new Date(image.createdAt).toLocaleString('ko-KR');

            card.innerHTML = `
                    <h3>ë¶„ì„ ê²°ê³¼: ${analysis}</h3>
                    <p>ID: ${image.id} | ìƒì„±: ${createdAt}</p>
                    <div class="image-pair">
                        <figure>
                            <figcaption><small>ì›ë³¸</small></figcaption>
                            <img src="${image.originalImageUrl}" alt="Original Image">
                        </figure>
                        <figure>
                            <figcaption><small>ë¶„ì„ ì™„ë£Œ</small></figcaption>
                            <img src="${image.segmentedImageUrl}" alt="Segmented Image">
                        </figure>
                    </div>
                `;
            resultsGrid.appendChild(card);
        });
    }

    function updatePagination(pageData) {
        currentPage = pageData.number + 1;
        totalPages = pageData.totalPages;
        pageInfo.textContent = `Page ${currentPage} / ${totalPages}`;
        prevBtn.disabled = pageData.first;
        nextBtn.disabled = pageData.last;
    }

    fetchBtn.addEventListener('click', () => fetchImages(1));
    prevBtn.addEventListener('click', () => { if (currentPage > 1) fetchImages(currentPage - 1); });
    nextBtn.addEventListener('click', () => { if (currentPage < totalPages) fetchImages(currentPage + 1); });
</script>

</body>
</html>